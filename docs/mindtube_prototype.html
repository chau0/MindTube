<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MindTube — MVP Prototype (Clickable Tabs + Dummy Data)</title>
<style>
  :root{
    --bg:#0b0e14;
    --panel:#111622;
    --muted:#98a2b3;
    --text:#e6e9ef;
    --accent:#6ea8fe;
    --ok:#22c55e;
    --warn:#f59e0b;
    --err:#ef4444;
    --border:#222a3b;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
    background:linear-gradient(180deg,#0b0e14 0%, #0f1421 100%); color:var(--text);
  }
  header{
    position:sticky; top:0; z-index:5;
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 20px; border-bottom:1px solid var(--border);
    background:rgba(11,14,20,0.86); backdrop-filter: blur(8px);
  }
  .brand{ font-weight:700; letter-spacing:0.3px; }
  .brand span{ color:var(--accent); }
  .actions button{
    margin-left:10px;
    background:#151b2b; color:var(--text); border:1px solid var(--border);
    padding:8px 12px; border-radius:10px; cursor:pointer;
  }
  .container{ max-width:980px; margin:22px auto 80px; padding:0 16px;}
  .card{
    background:radial-gradient(1200px 400px at 10% -20%, rgba(110,168,254,0.06), transparent 40%),
               radial-gradient(900px 300px at 90% -30%, rgba(34,197,94,0.05), transparent 45%),
               #0f1421;
    border:1px solid var(--border); border-radius:16px; padding:16px 16px;
  }
  .row{ display:flex; gap:10px; align-items:center; }
  input[type="url"]{
    flex:1; padding:12px 14px; border-radius:12px; color:var(--text);
    background:#0c1220; border:1px solid var(--border); outline:none;
  }
  input[type="url"]::placeholder{ color:#647087; }
  .btn{
    padding:12px 14px; border-radius:12px; border:1px solid var(--border); cursor:pointer;
    background:#1a2236; color:var(--text); font-weight:600;
  }
  .btn.primary{ background:linear-gradient(180deg,#1f2a44,#18233a); border-color:#24304b; }
  .btn.ghost{ background:#111827; }
  .helper{ color:var(--muted); font-size:13px; margin-top:8px; }
  .error{ color:var(--err); font-size:14px; margin-top:8px; display:none; }
  .progress{
    margin-top:16px; border:1px dashed #2a3652; border-radius:12px; padding:12px 14px;
  }
  .step{ display:flex; align-items:center; gap:10px; padding:6px 0; }
  .dot{ width:10px; height:10px; border-radius:50%; background:#334155; border:1px solid #475569;}
  .dot.done{ background:var(--ok); border-color:#16a34a; }
  .dot.active{ background:var(--warn); border-color:#d97706; box-shadow:0 0 0 4px rgba(245,158,11,0.1);}
  .early{ margin-top:10px; padding:10px; background:#0e1526; border:1px solid var(--border); border-radius:12px;}
  .tabs{ margin-top:16px; display:flex; gap:8px; flex-wrap:wrap; border-bottom:1px solid var(--border); }
  .tab{
    padding:10px 12px; border-radius:10px 10px 0 0; cursor:pointer; border:1px solid transparent;
  }
  .tab.active{
    border-color:var(--border); border-bottom-color:transparent; background:#0e1526;
  }
  .tabpanes{ border:1px solid var(--border); border-top:none; border-radius:0 0 16px 16px; padding:14px; background:#0e1526; }
  .pane{ display:none; }
  .pane.active{ display:block; }
  .timestamps a{
    display:inline-block; padding:4px 8px; border:1px solid #334155; border-radius:8px;
    margin-right:6px; margin-bottom:6px; text-decoration:none; color:var(--text);
  }
  .toolbar{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }
  .toolbar .btn{ padding:8px 10px; }
  .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0c1220; border:1px solid #1f2937; padding:2px 6px; border-radius:6px; font-size: 12px; }
  /* Modal basic */
  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:10; }
  .modal{ width:min(680px, 92vw); background:#0f1421; border:1px solid var(--border); border-radius:16px; padding:16px; }
  .modal h3{ margin:0 0 12px 0; }
  .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
  .muted{ color:var(--muted); font-size:13px; }
  .pill{ display:inline-block; padding:2px 8px; border:1px solid #334155; border-radius:999px; font-size:12px; color:#cbd5e1; }
  footer{ margin-top:18px; color:#93a0b6; font-size:12px; text-align:center; }
</style>
</head>
<body>
  <header>
    <div class="brand">Mind<span>Tube</span> — Prototype</div>
    <div class="actions">
      <button class="pill" id="openHistoryBtn">History</button>
      <button class="pill" id="openSettingsBtn">Settings</button>
      <a class="pill" href="#" id="downloadHtmlLink" download="mindtube_prototype.html" style="display:none;">Download HTML</a>
    </div>
  </header>

  <div class="container">
    <!-- Input Card -->
    <div class="card">
      <div class="row">
        <input id="urlInput" type="url" placeholder="Paste a YouTube URL, e.g., https://www.youtube.com/watch?v=abc123" />
        <button id="processBtn" class="btn primary">Process</button>
      </div>
      <div id="errorMsg" class="error">Please enter a valid YouTube URL.</div>
      <div class="helper">Tip: Works best with videos ≤ 90 min. English/Japanese supported.</div>

      <!-- Progress -->
      <div id="progress" class="progress" style="display:none;">
        <div class="step"><span class="dot" id="dot1"></span> Validating URL</div>
        <div class="step"><span class="dot" id="dot2"></span> Fetching captions</div>
        <div class="step"><span class="dot" id="dot3"></span> Chunking transcript</div>
        <div class="step"><span class="dot" id="dot4"></span> Summarizing</div>
        <div class="early">
          <strong>Early Output — Short Summary (partial):</strong>
          <div id="earlySummary" class="muted">Waiting for first chunks…</div>
        </div>
      </div>
    </div>

    <!-- Results -->
    <div id="resultsCard" class="card" style="margin-top:16px; display:none;">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <div>
          <div id="videoTitle" style="font-weight:700; font-size:18px;">—</div>
          <div id="videoMeta" class="muted">—</div>
        </div>
        <div class="toolbar">
          <button class="btn" id="copyBtn">Copy</button>
          <button class="btn" id="downloadBtn">Download .md</button>
          <button class="btn ghost" id="openYTBtn">Open on YouTube</button>
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="Results Tabs">
        <div class="tab active" role="tab" tabindex="0" aria-controls="pane-summary" id="tab-summary">Summary</div>
        <div class="tab" role="tab" tabindex="0" aria-controls="pane-ideas" id="tab-ideas">Key Ideas</div>
        <div class="tab" role="tab" tabindex="0" aria-controls="pane-takeaways" id="tab-takeaways">Takeaways</div>
        <div class="tab" role="tab" tabindex="0" aria-controls="pane-transcript" id="tab-transcript">Transcript</div>
      </div>
      <div class="tabpanes">
        <div class="pane active" id="pane-summary" role="tabpanel" aria-labelledby="tab-summary">
          <h3 style="margin:0 0 8px 0;">Short Summary</h3>
          <div id="shortSummary"></div>
          <h3 style="margin:14px 0 8px 0;">Detailed Summary</h3>
          <div id="detailedSummary"></div>
          <div style="margin-top:10px;">
            <div class="timestamps" id="summaryTimestamps"></div>
          </div>
        </div>

        <div class="pane" id="pane-ideas" role="tabpanel" aria-labelledby="tab-ideas">
          <ul id="ideasList"></ul>
        </div>

        <div class="pane" id="pane-takeaways" role="tabpanel" aria-labelledby="tab-takeaways">
          <ol id="takeawaysList"></ol>
        </div>

        <div class="pane" id="pane-transcript" role="tabpanel" aria-labelledby="tab-transcript">
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
            <input id="searchInput" type="text" placeholder="Find in transcript…" style="flex:1; padding:10px; border-radius:10px; border:1px solid var(--border); background:#0c1220; color:var(--text);" />
            <button id="searchBtn" class="btn">Search</button>
          </div>
          <div id="transcriptContent" style="max-height:380px; overflow:auto; border:1px solid var(--border); border-radius:10px; padding:10px;"></div>
        </div>
      </div>
    </div>

    <footer>Prototype • No backend required • Keyboard: <span class="kbd">Tab</span> to navigate, <span class="kbd">Enter</span> to activate</footer>
  </div>

  <!-- Settings Modal -->
  <div class="modal-backdrop" id="settingsBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <h3 id="settingsTitle">Settings</h3>
      <div class="grid">
        <label>Language priority
          <select id="langPriority" style="width:100%; padding:8px; border-radius:10px; background:#0c1220; color:var(--text); border:1px solid var(--border);">
            <option value="auto">Auto</option>
            <option value="en">English</option>
            <option value="ja">Japanese</option>
          </select>
        </label>
        <label>Duration limit (min)
          <input id="durLimit" type="number" value="90" min="10" max="300" style="width:100%; padding:8px; border-radius:10px; background:#0c1220; color:var(--text); border:1px solid var(--border);" />
        </label>
        <label>ASR fallback
          <select id="asrDefault" style="width:100%; padding:8px; border-radius:10px; background:#0c1220; color:var(--text); border:1px solid var(--border);">
            <option value="ask">Ask each time</option>
            <option value="off">Off</option>
            <option value="on">On</option>
          </select>
        </label>
        <label>Cost guardrail (¥/run)
          <input id="costLimit" type="number" value="25" min="0" step="1" style="width:100%; padding:8px; border-radius:10px; background:#0c1220; color:var(--text); border:1px solid var(--border);" />
        </label>
      </div>
      <div class="row" style="justify-content:flex-end; margin-top:12px;">
        <button class="btn" id="saveSettingsBtn">Save</button>
        <button class="btn ghost" id="closeSettingsBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div class="modal-backdrop" id="historyBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="historyTitle">
      <h3 id="historyTitle">History</h3>
      <div style="max-height:400px; overflow:auto; border:1px solid var(--border); border-radius:12px;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr style="background:#0c1220;">
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">When</th>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">Title</th>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">Duration</th>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">Actions</th>
            </tr>
          </thead>
          <tbody id="historyRows"></tbody>
        </table>
      </div>
      <div class="row" style="justify-content:flex-end; margin-top:12px;">
        <button class="btn" id="clearHistoryBtn">Clear</button>
        <button class="btn ghost" id="closeHistoryBtn">Close</button>
      </div>
    </div>
  </div>

<script>
(function(){
  // ----- Dummy data -----
  const dummy = {
    videoId: "abc123XYZ",
    title: "How to Learn Faster — Spaced Repetition Explained",
    channel: "Mind Lab",
    duration: "12:34",
    url: "https://www.youtube.com/watch?v=abc123XYZ",
    short: "This talk explains spaced repetition: reviewing material at increasing intervals to improve long‑term retention, reduce cognitive load, and focus practice on almost‑forgotten items.",
    detailed: [
      "The speaker introduces the forgetting curve and shows how scheduled reviews combat memory decay without excessive repetition.",
      "They demonstrate practical intervals (1d, 3d, 7d, 16d, etc.) and emphasize low‑friction logging of review sessions.",
      "Examples include language vocabulary and technical concepts; the method scales with minimal overhead.",
      "Caveats: too‑long gaps reset learning; too‑short gaps waste time. Calibrate intervals from prior performance."
    ],
    ideas: [
      ["00:45","Core premise: test‑enhanced learning beats passive rereading."],
      ["02:15","Forgetting curve motivates spaced intervals."],
      ["04:30","Active recall > recognition; keep prompts minimal."],
      ["07:42","Interleaving topics improves generalization."],
      ["10:10","Track performance to adapt intervals."]
    ],
    takeaways: [
      "Schedule short, frequent reviews; stop when recall is easy.",
      "Favor active recall (closed‑book prompts).",
      "Use timestamped anchors to revisit complex parts.",
      "Iteratively extend intervals based on success rate.",
      "Keep logs lightweight; avoid tool overhead."
    ],
    transcript: [
      ["00:00","Welcome to the session on spaced repetition."],
      ["00:12","Today we'll cover the forgetting curve and active recall."],
      ["00:45","The core premise is that retrieval practice cements memory."],
      ["02:15","Ebbinghaus showed that memory decays rapidly without review."],
      ["04:30","Active recall prompts should be brief, forcing memory retrieval."],
      ["07:42","Interleaving multiple topics can improve transfer."],
      ["10:10","Adapt intervals based on how difficult recall was."]
    ]
  };

  // ----- State & Elements -----
  const urlInput = document.getElementById('urlInput');
  const processBtn = document.getElementById('processBtn');
  const errorMsg = document.getElementById('errorMsg');
  const progress = document.getElementById('progress');
  const dots = [1,2,3,4].map(i => document.getElementById('dot'+i));
  const earlySummary = document.getElementById('earlySummary');

  const resultsCard = document.getElementById('resultsCard');
  const videoTitle = document.getElementById('videoTitle');
  const videoMeta = document.getElementById('videoMeta');
  const shortSummary = document.getElementById('shortSummary');
  const detailedSummary = document.getElementById('detailedSummary');
  const summaryTimestamps = document.getElementById('summaryTimestamps');
  const ideasList = document.getElementById('ideasList');
  const takeawaysList = document.getElementById('takeawaysList');
  const transcriptContent = document.getElementById('transcriptContent');

  const tabIds = ['summary','ideas','takeaways','transcript'];
  const tabEls = tabIds.map(id => document.getElementById('tab-'+id));
  const paneEls = tabIds.map(id => document.getElementById('pane-'+id));

  const copyBtn = document.getElementById('copyBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const openYTBtn = document.getElementById('openYTBtn');

  const searchInput = document.getElementById('searchInput');
  const searchBtn = document.getElementById('searchBtn');

  // Modals
  const settingsBackdrop = document.getElementById('settingsBackdrop');
  const openSettingsBtn = document.getElementById('openSettingsBtn');
  const closeSettingsBtn = document.getElementById('closeSettingsBtn');
  const saveSettingsBtn = document.getElementById('saveSettingsBtn');

  const historyBackdrop = document.getElementById('historyBackdrop');
  const openHistoryBtn = document.getElementById('openHistoryBtn');
  const closeHistoryBtn = document.getElementById('closeHistoryBtn');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  const historyRows = document.getElementById('historyRows');

  // ----- Helpers -----
  function validYouTubeUrl(url){
    const r = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/i;
    return r.test(url);
  }
  function setDotActive(i){
    dots.forEach((d,idx)=>{
      d.classList.remove('active','done');
      if(idx < i-1) d.classList.add('done');
      if(idx === i-1) d.classList.add('active');
    });
  }
  function setAllDone(){
    dots.forEach(d=>{ d.classList.remove('active'); d.classList.add('done'); });
  }
  function openModal(backdrop){
    backdrop.style.display = 'flex';
    backdrop.setAttribute('aria-hidden','false');
  }
  function closeModal(backdrop){
    backdrop.style.display = 'none';
    backdrop.setAttribute('aria-hidden','true');
  }
  function timeToSeconds(ts){
    const parts = ts.split(':');
    if(parts.length === 2){ // mm:ss
      return parseInt(parts[0],10)*60 + parseInt(parts[1],10);
    }else if(parts.length===3){ // hh:mm:ss
      return parseInt(parts[0],10)*3600 + parseInt(parts[1],10)*60 + parseInt(parts[2],10);
    }
    return 0;
  }

  function renderResults(d){
    resultsCard.style.display = 'block';
    videoTitle.textContent = d.title;
    videoMeta.textContent = d.channel + " • " + d.duration;

    shortSummary.textContent = d.short;
    detailedSummary.innerHTML = d.detailed.map(p => `<p>${p}</p>`).join('');

    summaryTimestamps.innerHTML = d.ideas.slice(0,3).map(([ts,text]) => {
      const sec = timeToSeconds(ts);
      const href = d.url + "&t=" + sec + "s";
      return `<a href="${href}" target="_blank" rel="noopener">${ts}</a>`;
    }).join('');

    ideasList.innerHTML = d.ideas.map(([ts, text]) => {
      const sec = timeToSeconds(ts);
      const href = d.url + "&t=" + sec + "s";
      return `<li>(${ts}) ${text} <a href="${href}" target="_blank" rel="noopener">▶</a></li>`;
    }).join('');

    takeawaysList.innerHTML = d.takeaways.map(t => `<li>${t}</li>`).join('');

    transcriptContent.innerHTML = d.transcript.map(([ts, line]) => {
      const sec = timeToSeconds(ts);
      const href = d.url + "&t=" + sec + "s";
      return `<div><span class="pill">${ts}</span> ${line} <a href="${href}" target="_blank" rel="noopener">▶</a></div>`;
    }).join('');
  }

  function selectTab(id){
    tabEls.forEach((el, idx)=>{
      const active = tabIds[idx] === id;
      el.classList.toggle('active', active);
      paneEls[idx].classList.toggle('active', active);
    });
  }

  function getMarkdownFromDom(){
    const title = videoTitle.textContent.trim();
    const meta = videoMeta.textContent.trim();
    const short = shortSummary.textContent.trim();
    const detailed = Array.from(detailedSummary.querySelectorAll('p')).map(p => p.textContent.trim());
    const ideas = Array.from(ideasList.querySelectorAll('li')).map(li => li.textContent.trim());
    const takes = Array.from(takeawaysList.querySelectorAll('li')).map(li => li.textContent.trim());

    const md = [
      `# ${title}`,
      '',
      `_${meta}_`,
      '',
      '## Short Summary',
      short,
      '',
      '## Detailed Summary',
      ...detailed.map(p => `- ${p}`),
      '',
      '## Key Ideas',
      ...ideas.map(i => `- ${i}`),
      '',
      '## Actionable Takeaways',
      ...takes.map(t => `- ${t}`),
      ''
    ].join('\n');
    return md;
  }

  function copyText(text){
    if(navigator.clipboard){
      navigator.clipboard.writeText(text).then(()=>{
        showToast("Copied to clipboard");
      });
    }else{
      const ta = document.createElement('textarea');
      ta.value = text; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); showToast("Copied"); } finally{ document.body.removeChild(ta); }
    }
  }

  function showToast(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position='fixed'; el.style.bottom='20px'; el.style.right='20px';
    el.style.background='#111827'; el.style.border='1px solid #374151'; el.style.padding='10px 12px';
    el.style.borderRadius='10px'; el.style.zIndex=50;
    document.body.appendChild(el);
    setTimeout(()=>{ el.remove(); }, 1400);
  }

  function loadHistory(){
    const arr = JSON.parse(localStorage.getItem('mindtube_history') || '[]');
    historyRows.innerHTML = arr.map((item, idx) => {
      return `<tr>
        <td style="padding:8px; border-bottom:1px solid var(--border);">${item.when}</td>
        <td style="padding:8px; border-bottom:1px solid var(--border);">${item.title}</td>
        <td style="padding:8px; border-bottom:1px solid var(--border);">${item.duration}</td>
        <td style="padding:8px; border-bottom:1px solid var(--border);">
          <button data-idx="${idx}" class="btn btn-open" style="padding:6px 8px;">Open</button>
          <button data-idx="${idx}" class="btn ghost btn-del" style="padding:6px 8px;">Delete</button>
        </td>
      </tr>`;
    }).join('');
  }

  function addToHistory(item){
    const arr = JSON.parse(localStorage.getItem('mindtube_history') || '[]');
    arr.unshift(item);
    localStorage.setItem('mindtube_history', JSON.stringify(arr.slice(0,20)));
  }

  // ----- Events -----
  processBtn.addEventListener('click', () => {
    const url = urlInput.value.trim() || dummy.url; // allow blank to demo
    if(!validYouTubeUrl(url)){
      errorMsg.style.display = 'block'; return;
    }
    errorMsg.style.display = 'none';
    resultsCard.style.display = 'none';

    progress.style.display = 'block';
    earlySummary.textContent = 'Waiting for first chunks…';
    setDotActive(1);

    // Simulate stages
    setTimeout(()=>{ setDotActive(2); }, 700);
    setTimeout(()=>{ setDotActive(3); earlySummary.textContent = 'Spaced repetition uses increasing intervals to optimize retention…'; }, 1500);
    setTimeout(()=>{
      setDotActive(4);
      earlySummary.textContent = 'Early short summary ready. Finalizing…';
    }, 2300);
    setTimeout(()=>{
      setAllDone();
      renderResults(dummy);
      resultsCard.scrollIntoView({behavior:'smooth'});
      // Save basic history
      const when = new Date().toLocaleString();
      addToHistory({ when, title: dummy.title, duration: dummy.duration });
    }, 3000);
  });

  urlInput.addEventListener('input', ()=>{ errorMsg.style.display='none'; });

  // Tabs
  tabEls.forEach((el) => {
    el.addEventListener('click', () => selectTab(el.id.replace('tab-','')));
    el.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        selectTab(el.id.replace('tab-',''));
      }
    });
  });

  // Toolbar
  copyBtn.addEventListener('click', ()=>{
    copyText(getMarkdownFromDom());
  });
  downloadBtn.addEventListener('click', ()=>{
    const md = getMarkdownFromDom();
    const blob = new Blob([md], {type: 'text/markdown'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = (dummy.title.replace(/\s+/g,'_').slice(0,80) || 'MindTube') + '.md';
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
  });
  openYTBtn.addEventListener('click', ()=>{
    const first = dummy.ideas[0];
    const sec = timeToSeconds(first[0]);
    window.open(dummy.url + "&t=" + sec + "s", "_blank", "noopener");
  });

  // Transcript search (very simple highlight)
  searchBtn.addEventListener('click', ()=>{
    const q = (searchInput.value || '').trim().toLowerCase();
    if(!q){ transcriptContent.querySelectorAll('mark').forEach(m=>{ m.replaceWith(m.textContent); }); return; }
    const nodes = Array.from(transcriptContent.childNodes);
    nodes.forEach(node => {
      if(node.nodeType === 1){ // element
        const html = node.innerHTML;
        const safeQ = q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const re = new RegExp('('+safeQ+')','gi');
        node.innerHTML = html.replace(/<mark>|<\/mark>/g,'').replace(re, '<mark>$1</mark>');
      }
    });
  });

  // Settings
  openSettingsBtn.addEventListener('click', ()=>{ openModal(settingsBackdrop); });
  closeSettingsBtn.addEventListener('click', ()=>{ closeModal(settingsBackdrop); });
  saveSettingsBtn.addEventListener('click', ()=>{
    showToast('Settings saved');
    closeModal(settingsBackdrop);
  });

  // History
  openHistoryBtn.addEventListener('click', ()=>{
    loadHistory();
    openModal(historyBackdrop);
  });
  closeHistoryBtn.addEventListener('click', ()=> closeModal(historyBackdrop));
  clearHistoryBtn.addEventListener('click', ()=>{
    localStorage.removeItem('mindtube_history'); loadHistory();
  });
  historyRows.addEventListener('click', (e)=>{
    const t = e.target;
    if(t.classList.contains('btn-open')){
      renderResults(dummy);
      closeModal(historyBackdrop);
      resultsCard.scrollIntoView({behavior:'smooth'});
    }
    if(t.classList.contains('btn-del')){
      const idx = parseInt(t.getAttribute('data-idx'),10);
      const arr = JSON.parse(localStorage.getItem('mindtube_history') || '[]');
      arr.splice(idx,1);
      localStorage.setItem('mindtube_history', JSON.stringify(arr));
      loadHistory();
    }
  });

  // Keyboard: Esc closes modals
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape'){
      [settingsBackdrop, historyBackdrop].forEach(b=>{
        if(b.getAttribute('aria-hidden')==='false') closeModal(b);
      });
    }
  });

  // Pre-render dummy results to let users see tabs without processing
  // Comment out the next two lines if you want a blank initial state.
  // renderResults(dummy);
  // resultsCard.style.display = 'block';
})();
</script>
</body>
</html>
